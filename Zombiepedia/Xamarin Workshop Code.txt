--------- Setup the project ----------------------------
* Create new project of type "Blank App (Xamarin.Forms Portable)" named ZombiepediaApp

--------- Add initial view and configure application to use it --------------
* Add a folder called "Views" to the shared project
* Add new "Forms XAML Page" called "HomeView" and paste the following code into it

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
			 xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
			 x:Class="ZombiepediaApp.Views.HomeView">
	<Label Text="Goodbye World!" VerticalOptions="Center" HorizontalOptions="Center" />
</ContentPage>

* Modify the app.cs and set the "MainPage" property to:
    MainPage = new HomeView();

----------- Formatting Text ------------------------
* Replace the Label element with the following
	<Label Text="Goodbye World!" VerticalOptions="Center" HorizontalOptions="Center" FontSize="36" />

----------- Grid Layout Example ------------------------	
* Replace the Label element with the following
  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>
  
    <Label Grid.Row="0" Text="Zombiepedia" VerticalOptions="Center" HorizontalOptions="Center" FontSize="24" />
    
    <Label Grid.Row="1" Text="List of zombies..." VerticalOptions="Center" HorizontalOptions="Center" FontSize="36" />
  </Grid>
  
------------ Data Binding Example -------------
* Replace the first Label element with the following:
      <Label Grid.Row="0" Text="{Binding Header}" VerticalOptions="Center" HorizontalOptions="Center" FontSize="24" />

* Edit the code behind file (HomeView.xaml.cs) and replace the contents with the following:
using Xamarin.Forms;

namespace ZombiepediaApp.Views
{
	public partial class HomeView : ContentPage
	{
		public string Header { get; set; }

		public HomeView()
		{
			InitializeComponent();

			Header = "Zombiepedia";
			this.BindingContext = this;
		}
	}
}

----------- ListView Example -------------
* Replace the second label with the following
    <ListView Grid.Row="1 " ItemsSource="{Binding Zombies}" />

* Replace the contents of the HomeView.xaml.cs with the following
using System.Collections.ObjectModel;
using Xamarin.Forms;

namespace ZombiepediaApp.Views
{
    public partial class HomeView : ContentPage
    {
        public string Header { get; set; }
        public ObservableCollection<string> Zombies { get; set; }

        public HomeView()
        {
            InitializeComponent();

            Header = "Zombiepedia";
            Zombies = new ObservableCollection<string>() { "Ankle Biters", "Shufflers"};
            this.BindingContext = this;
        }
    }
}

----------- ViewModel Example ---------------
* Add a folder called "ViewModels" to the shared project
* Add a new class to the "ViewModels" folder and call it "HomeViewModel"
* Replace the contents of the new class with the following
using System.Collections.ObjectModel;

namespace ZombiepediaApp.ViewModels
{
    public class HomeViewModel
    {
        public string Header { get; set; }
        public ObservableCollection<string> Zombies { get; set; }

        public HomeViewModel()
        {
            Header = "Zombiepedia";
            Zombies = new ObservableCollection<string>() { "Ankle Biters", "Shufflers" };
        }
    }
}

* Replace the contents of the HomeView.xaml.cs with the following
using Xamarin.Forms;
using ZombiepediaApp.ViewModels;

namespace ZombiepediaApp.Views
{
    public partial class HomeView : ContentPage
    {
        public HomeView()
        {
            InitializeComponent();
            this.BindingContext = new HomeViewModel();
        }
    }
}

-------------- Introduce Zombie Web Service ------------------------
* Add the Newtonsoft JSON nuget package to the portable project
* Add the Microsoft.Net.Http nuget package to the portable project
* Add a "Models" folder to the portable project
* Add a class to the "Models" folder called "Zombie.cs" and replace the contents with the following
namespace ZombiepediaApp.Models
{
    public class Zombie
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public string Description { get; set; }
    }
}

* Add a "Services" folder to the portable project
* Add a class to the "Services" folder called "ZombieDataService.cs" and replace the content with the following
using System;
using System.Collections.Generic;
using System.Net.Http;
using System.Threading.Tasks;
using Newtonsoft.Json;
using ZombiepediaApp.Models;

namespace ZombiepediaApp.Services
{
    public static class ZombieDataService
    {
        public static async Task<List<Zombie>> GetZombies()
        {
            var service = new HttpClient
            {
                BaseAddress = new Uri("http://zombiepedia.azurewebsites.net")
            };
            var response = await service.GetAsync("api/zombies");
            var data = await response.Content.ReadAsStringAsync();
            var zombies = JsonConvert.DeserializeObject<List<Zombie>>(data);
            return zombies;
        }
    }
}

* Replace the contents of the "HomeViewModel.cs" file with the following
using System.Collections.ObjectModel;
using ZombiepediaApp.Models;
using ZombiepediaApp.Services;

namespace ZombiepediaApp.ViewModels
{
    public class HomeViewModel
    {
        public string Header { get; set; }
        public ObservableCollection<Zombie> Zombies { get; set; }

        public HomeViewModel()
        {
            Header = "Zombiepedia";
            Zombies = new ObservableCollection<Zombie>();
            LoadZombies();
        }

        public async void LoadZombies()
        {
            var serviceZombies = await ZombieDataService.GetZombies();
            foreach (var zombie in serviceZombies)
            {
                Zombies.Add(zombie);
            }
        }
    }
}

* Show how a delay in populating the list - add after Zombies.Add(zombie);
	await Task.Delay(1000);

------------- Simple DataTemplate Example --------------
* Replace the ListView element with the following
    <ListView Grid.Row="1 " ItemsSource="{Binding Zombies}">
      <ListView.ItemTemplate>
        <DataTemplate>
          <ViewCell>
            <Label Text="{Binding Name}"/>
          </ViewCell>
        </DataTemplate>
      </ListView.ItemTemplate> 
    </ListView>
	
------------- Advanced DataTemplate Example ------------
* Replace the ListView element with the following
    <ListView Grid.Row="1 " ItemsSource="{Binding Zombies}">
      <ListView.ItemTemplate>
        <DataTemplate>
          <ViewCell>
            <StackLayout Orientation="Horizontal">
              <Image Source="{Binding ImagePath}" />
              <Label Text="{Binding Name}" FontSize="24"/>
            </StackLayout>
          </ViewCell>
        </DataTemplate>
      </ListView.ItemTemplate>
    </ListView>

------------ Add Details Page -------------------------
* Add a new "Forms Xaml Page" called "DetailView" to the Views folder and replace its contents with the following
<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ZombiepediaApp.Views.DetailView">
  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>
    
    <Image Grid.Row="0" Source="{Binding ImagePath}"/>
    
    <Label Grid.Row="1" Text="{Binding Name}" FontSize="36" HorizontalOptions="Center" />
    
    <Label Grid.Row="2" Text="{Binding Description}" FontSize="18" HorizontalOptions="Center" />
    
    <ListView Grid.Row="3" ItemsSource="{Binding Comments}" />
    
  </Grid>
</ContentPage>

* Replace the contents of the new code behind page with the following
using Xamarin.Forms;
using ZombiepediaApp.Models;
using ZombiepediaApp.ViewModels;

namespace ZombiepediaApp.Views
{
    public partial class DetailView : ContentPage
    {
        public DetailView(Zombie zombie)
        {
            InitializeComponent();
            var viewModel = new DetailViewModel(zombie);
            this.BindingContext = viewModel;
        }
    }
}

* Add a new class called "DetailViewModel.cs" to the ViewModels folder and replace its contents with the following
using System;
using System.Collections.ObjectModel;
using ZombiepediaApp.Models;

namespace ZombiepediaApp.ViewModels
{
    public class DetailViewModel
    {
        private Zombie Zombie { get; set; }
        public String Name => Zombie.Name;
        public String Description => Zombie.Description;
        public String ImagePath => Zombie.ImagePath;
        public ObservableCollection<string> Comments { get; set; }

        public DetailViewModel(Zombie zombie)
        {
            Zombie = zombie;
        }

    }
}

* Add a folder to the portable project called "XamlHelpers"
* Add a new class to the new "XamlHelpers" folder called "ListViewCommands.cs" and replace its contents with the following
using Xamarin.Forms;

namespace ZombiepediaApp.XamlHelpers
{
	public class ListViewCommands
	{
		public static readonly BindableProperty ItemTappedProperty =
			BindableProperty.CreateAttached<ListViewCommands, Command>(
				bindable => GetItemTapped(bindable),
				null,
				BindingMode.OneWay,
				null,
				OnItemTappedChanged,
				null,
				null);

		public static Command GetItemTapped(BindableObject bo)
		{
			return (Command)bo.GetValue(ItemTappedProperty);
		}

		public static void SetItemTapped(BindableObject bo, Command value)
		{
			bo.SetValue(ItemTappedProperty, value);
		}

		public static void OnItemTappedChanged(BindableObject bo, Command oldValue, Command newValue)
		{
			var lv = bo as ListView;
			if (lv != null)
			{
				lv.ItemTapped += (sender, args) =>
				{
					newValue.Execute(args.Item);
				};
			}
		}
	}
}

* Update the ListView element on the HomeView.Xaml view to the following
    <ListView Grid.Row="1 " ItemsSource="{Binding Zombies}" 
              SelectedItem="{Binding SelectedZombie}"
              xh:ListViewCommands.ItemTapped="{Binding ZombieSelectedCommand}" >
      <ListView.ItemTemplate>
        <DataTemplate>
          <ViewCell>
            <StackLayout Orientation="Horizontal">
              <Image Source="{Binding ImagePath}" />
              <Label Text="{Binding Name}" FontSize="24"/>
            </StackLayout>
          </ViewCell>
        </DataTemplate>
      </ListView.ItemTemplate>
    </ListView>
	
* Replace the contents of the HomeViewModel.cs file with the following
using System.Collections.ObjectModel;
using System.Windows.Input;
using Xamarin.Forms;
using ZombiepediaApp.Models;
using ZombiepediaApp.Services;

namespace ZombiepediaApp.ViewModels
{
    public class HomeViewModel
    {
        public string Header { get; set; }
        public ObservableCollection<Zombie> Zombies { get; set; }
        public Zombie SelectedZombie { get; set; }
        public ICommand ZombieSelectedCommand { get; private set; }

        public HomeViewModel()
        {
            Header = "Zombiepedia";
            ZombieSelectedCommand = new Command(ZombieSelectedExecute);
            Zombies = new ObservableCollection<Zombie>();
            LoadZombies();
        }

        public async void LoadZombies()
        {
            var serviceZombies = await ZombieDataService.GetZombies();
            foreach (var zombie in serviceZombies)
            {
                Zombies.Add(zombie);
            }
        }

        private void ZombieSelectedExecute()
        {
            MessagingCenter.Send(SelectedZombie, "NavigateToZombie");
        }

    }
}

* Update the App.cs file with the following
	private NavigationPage rootNavigationPage;
	public App()
	{
		// The root page of your application
		MessagingCenter.Subscribe<Zombie>(this, "NavigateToZombie", NavigateToZombie);
		rootNavigationPage = new NavigationPage(new HomeView());
		MainPage = rootNavigationPage;
	}

------------- Update Title --------------------------
* Update the ContentPage element of HomeView.Xaml with the following
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:xh="clr-namespace:ZombiepediaApp.XamlHelpers;assembly=ZombiepediaApp"
             x:Class="ZombiepediaApp.Views.HomeView" 
             Title="{Binding Header}">

* Update the ContentPage element of DetailView.Xaml with the following
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ZombiepediaApp.Views.DetailView" 
             Title="{Binding Header}">
		
* Add the following property to the DetailViewModel.cs
        public String Header => $"Zombiepedia - {Zombie.Name}";

------------ Add comments to detail page ------------------
* Add the following to the ZombieDataService
        public static async Task<List<string>> GetComments(int id)
        {
            var service = new HttpClient
            {
                BaseAddress = new Uri("http://zombiepedia.azurewebsites.net")
            };
            var response = await service.GetAsync($"api/comment/{id}");
            var data = await response.Content.ReadAsStringAsync();
            var comments = JsonConvert.DeserializeObject<List<string>>(data);
            return comments;
        }
		
* Update the following in the DetailViewModel
        public DetailViewModel(Zombie zombie)
        {
            Zombie = zombie;
            GetComments();
        }

        private async void GetComments()
        {
            Comments = new ObservableCollection<string>();
            var comments = await ZombieDataService.GetComments(Zombie.Id);

            foreach (var comment in comments)
            {
                Comments.Add(comment);
            }
        }



